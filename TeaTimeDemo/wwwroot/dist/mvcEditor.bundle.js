(()=>{function t(){var t=function(){var t=$('input[name="Survey.Title"]').val(),e=$('textarea[name="Survey.Description"]').val(),i=$('select[name="Survey.StationName"] option:selected').text(),n=$('input[name="Survey.QuestionNum"]').val(),a="";$("#survey-image-preview img").each((function(){var t=$(this).attr("src"),e=$(this).attr("data-image-id"),i=$(this).css("width").replace("px","")||200,n=$(this).css("height").replace("px","")||200;a+='<img src="'.concat(t,'" alt="問卷圖片" data-image-id="').concat(e,'" style="width:').concat(i,"px; height:").concat(n,'px;" /><br />')}));var c="";$("#questions .question-container").each((function(){var t=$(this).find('input[name$=".Question.QuestionText"]').val(),e=($(this).find('select[name$=".Question.AnswerType"]').val(),$(this).find('select[name$=".Question.AnswerType"] option:selected').text()),i="",n=$(this).attr("id").split("-")[1];$(this).find(".option-container").each((function(){var t=$(this).find('input[name$=".QuestionOption.OptionText"]').val(),a=$(this).attr("id").split("-")[2],c=t,o=0,s={};$(this).find(".fill-in-blank").each((function(){var t=$(this).find("h5").text().replace("填空 ",""),e=parseInt($(this).find('input[name$=".Length"]').val())||5,i=(parseInt($(this).find('input[name$=".Position"]').val()),$(this).find('input[name$=".Placeholder"]').val()||"");s[t]={length:e,placeholder:i}})),c=c.replace(/\$\{填空(\d+)\}\$/g,(function(t,e){var i=e,c="QuestionVMs[".concat(n,"].QuestionOptionVMs[").concat(a,"].FillInBlanks[").concat(o,"].AnswerText"),r=s[i]||{length:5,placeholder:""},l=r.length,d=r.placeholder,p="width: ".concat(10*l,"px;"),h='<input type="hidden" name="QuestionVMs['.concat(n,"].QuestionOptionVMs[").concat(a,"].FillInBlanks[").concat(o,'].Length" value="').concat(l,'" />');return o++,"".concat(h,'<input type="text" name="').concat(c,'" placeholder="').concat(d,'" class="form-control fill-in-blank-input" style="').concat(p,'" />')}));var r="";switch(e.toLowerCase()){case"單選":case"radio":var l=$(this).find('input[name$=".QuestionOption.Id"]').val();r+='<input type="radio" name="Questions['.concat(n,'].SelectedOption" value="').concat(l,'" id="option_').concat(l,'" required> ')+'<label for="option_'.concat(l,'">').concat(c,"</label><br />");break;case"多選":case"checkbox":l=$(this).find('input[name$=".QuestionOption.Id"]').val(),r+='<input type="checkbox" name="Questions['.concat(n,'].SelectedOptions" value="').concat(l,'" id="option_').concat(l,'"> ')+'<label for="option_'.concat(l,'">').concat(c,"</label><br />");break;case"填空":case"text":r+='<input type="text" name="Questions['.concat(n,'].AnswerText" required class="form-control" /><br />');break;case"填空框":case"textarea":r+='<textarea name="Questions['.concat(n,'].AnswerText" required class="form-control"></textarea><br />');break;case"下拉選單":case"select":r+='<select name="Questions['.concat(n,'].AnswerText" class="form-select"><option>').concat(t,"</option></select><br />");break;default:r+="".concat(c,"<br />")}var d="";$(this).find(".option-image-preview img").each((function(){var t=$(this).attr("src"),e=$(this).attr("data-image-id"),i=$(this).css("width").replace("px","")||200,n=$(this).css("height").replace("px","")||200;d+='<img src="'.concat(t,'" alt="選項圖片" data-image-id="').concat(e,'" style="width:').concat(i,"px; height:").concat(n,'px;" /><br />')})),d&&(r+="<br />".concat(d)),i+=r}));var a="";$(this).find(".question-image-preview img").each((function(){var t=$(this).attr("src"),e=$(this).attr("data-image-id"),i=$(this).css("width").replace("px","")||200,n=$(this).css("height").replace("px","")||200;a+='<img src="'.concat(t,'" alt="問題圖片" data-image-id="').concat(e,'" style="width:').concat(i,"px; height:").concat(n,'px;" /><br />')}));var o="<h3>".concat(t," (").concat(e,")</h3>");a&&(o+="<div>".concat(a,"</div>")),i&&(o+="<div>".concat(i,"</div>")),c+=o}));var o="<h1>".concat(t,'<span style="font-size: 0.7em; margin-left: 10px;">')+"站別: ".concat(i," 頁數：").concat(n)+"</span></h1>"+"<p>".concat(e,"</p>");return a&&(o+="<div>".concat(a,"</div>")),o+=c}();$("#MceHtml").val(t),tinymce.get("editor").setContent(t)}$(document).ready((function(){window.questionIndex=window.initialData.questionCount||0,window.optionsIndices=window.initialData.optionsIndices||{},function(){window.fillInBlankIndices={};for(var t=0;t<window.questionIndex;t++)window.fillInBlankIndices[t]={},$("#options-"+t+" .option-container").each((function(e){var i=$(this).find(".fill-in-blank").length;window.fillInBlankIndices[t][e]=i}))}(),tinymce.init({selector:"#editor",api_key:"bd4kr41e6ze0pbf2aykxdz4hsbpnedbrhpjj227b6za85wou",plugins:"advlist autolink lists link image charmap preview anchor code table",toolbar:"undo redo | formatselect | bold italic backcolor | code | table | image | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat",height:"100%",image_dimensions:!0,image_advtab:!0,extended_valid_elements:"img[src|alt|data-image-id|width|height|style|class]",valid_styles:{img:"width,height"},setup:function(e){e.on("init",(function(){var i=$("#MceHtml").val();e.setContent(i),""===i.trim()?t():tinymce.get("editor").dom.select("img").forEach((function(t){var e,i,n=(e=t.getAttribute("src"),(i=document.createElement("a")).href=e,i.pathname),a=window.initialData.imageMappings[n];a&&t.setAttribute("data-image-id",a)}))})),e.on("change keyup",(function(){tinymce.triggerSave(),$("#MceHtml").val(e.getContent())})),e.on("ObjectResized",(function(t){var e,i,n,a=t.target;"img"===a.tagName.toLowerCase()&&(e=a.getAttribute("data-image-id"),i=t.width,n=t.height,$('#survey-image-preview img[data-image-id="'+e+'"]').each((function(){$(this).css({width:i+"px",height:n+"px"});var t=$(this).closest(".image-upload-group");t.find('input[name$="Widths"]').val(i),t.find('input[name$="Heights"]').val(n),t.find('input[type="range"][data-target="width"]').val(i),t.find('input[type="range"][data-target="height"]').val(n)})),$("#questions .question-container").each((function(){$(this).find('.question-image-preview img[data-image-id="'+e+'"]').each((function(){$(this).css({width:i+"px",height:n+"px"});var t=$(this).closest(".image-upload-group");t.find('input[name$="Widths"]').val(i),t.find('input[name$="Heights"]').val(n),t.find('input[type="range"][data-target="width"]').val(i),t.find('input[type="range"][data-target="height"]').val(n)}))})),$("#questions .question-container").each((function(){$(this).find('.option-image-preview img[data-image-id="'+e+'"]').each((function(){$(this).css({width:i+"px",height:n+"px"});var t=$(this).closest(".image-upload-group");t.find('input[name$="Widths"]').val(i),t.find('input[name$="Heights"]').val(n),t.find('input[type="range"][data-target="width"]').val(i),t.find('input[type="range"][data-target="height"]').val(n)}))})))}))},content_style:"body { font-size:14px; }",image_class_list:[{title:"None",value:""},{title:"Responsive",value:"img-responsive"}],image_title:!0,automatic_uploads:!0,images_upload_handler:function(t){return new Promise((function(e,i){var n=new FormData;n.append("image",t.blob(),t.filename()),$.ajax({url:"/admin/survey/uploadimage",type:"POST",data:n,processData:!1,contentType:!1,success:function(t){t.success?e(t.imageUrl):i(t.message||"圖片上傳失敗。")},error:function(){i("圖片上傳失敗。")}})}))}}),t()})),$(document).on("input",'input[name$=".Length"]',(function(){t()}))})();
//# sourceMappingURL=mvcEditor.bundle.js.map